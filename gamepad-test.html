<!DOCTYPE html>
<html>
<head>
    <title>Gamepad Tester - Taranis X7</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #fff; 
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #4CAF50; }
        .status { 
            font-size: 24px; 
            margin: 20px 0; 
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .connected { 
            background: #4CAF50; 
            color: white;
        }
        .disconnected { 
            background: #f44336; 
            color: white;
        }
        .gamepad-info { 
            background: #2d2d2d; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
        .axis { 
            margin: 15px 0; 
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
        .axis-bar { 
            width: 100%; 
            height: 40px; 
            background: #444; 
            position: relative; 
            border-radius: 5px; 
            margin-top: 5px;
        }
        .axis-value { 
            position: absolute; 
            height: 100%; 
            background: #4CAF50; 
            border-radius: 5px; 
            transition: width 0.05s;
        }
        .axis-center { 
            position: absolute; 
            left: 50%; 
            width: 3px; 
            height: 100%; 
            background: rgba(255,255,255,0.3);
        }
        .axis-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .axis-number {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }
        .axis-raw {
            font-family: 'Courier New', monospace;
            color: #888;
        }
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .button { 
            width: 100%;
            height: 60px; 
            border-radius: 8px; 
            background: #444; 
            text-align: center; 
            line-height: 60px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.1s;
        }
        .button.pressed { 
            background: #4CAF50; 
            transform: scale(0.95);
            box-shadow: 0 0 20px #4CAF50;
        }
        .info { 
            background: #2a52be; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }
        .warning {
            background: #ff9800;
            color: #000;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
        .config-recommendation {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #4CAF50;
        }
        .config-recommendation code {
            background: #1e1e1e;
            padding: 2px 6px;
            border-radius: 3px;
            color: #4CAF50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        th {
            background: #333;
            color: #4CAF50;
        }
        .highlight {
            background: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üéÆ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–π–º–ø–∞–¥–∞ Taranis X7</h1>
    
    <div id="status" class="status disconnected">
        ‚ùå –ì–µ–π–º–ø–∞–¥ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
    </div>
    
    <div class="info">
        <strong>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Taranis X7:</strong><br>
        1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Taranis X7 –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É —á–µ—Ä–µ–∑ USB<br>
        2. –ù–∞ –ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫–µ: <strong>MENU ‚Üí SETUP ‚Üí USB Mode ‚Üí USB Joystick (HID)</strong><br>
        3. –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –∏–ª–∏ –ø–æ–¥–≤–∏–≥–∞–π—Ç–µ —Å—Ç–∏–∫ –Ω–∞ –ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫–µ<br>
        4. –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –Ω–∏–∂–µ ‚¨áÔ∏è
    </div>
    
    <div id="gamepadInfo" class="gamepad-info" style="display:none;">
        <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–µ–π–º–ø–∞–¥–µ</h2>
        <div id="gamepadId" style="font-size: 14px; color: #888; margin-bottom: 20px;"></div>
        
        <h3>üïπÔ∏è –û—Å–∏ (Sticks)</h3>
        <div id="axes"></div>
        
        <h3>üîò –ö–Ω–æ–ø–∫–∏ (Switches)</h3>
        <div id="buttons" class="buttons-grid"></div>
        
        <div id="recommendation" class="config-recommendation" style="display:none;">
            <h3>‚öôÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
            <div id="configText"></div>
        </div>
    </div>

    <script>
        let animationId = null;
        let detectedAxes = new Set();
        let lastValues = {};

        function updateGamepadStatus() {
            const gamepads = navigator.getGamepads();
            let gamepad = null;

            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i]) {
                    gamepad = gamepads[i];
                    break;
                }
            }

            const statusEl = document.getElementById('status');
            const infoEl = document.getElementById('gamepadInfo');

            if (!gamepad) {
                statusEl.className = 'status disconnected';
                statusEl.textContent = '‚ùå –ì–µ–π–º–ø–∞–¥ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
                infoEl.style.display = 'none';
                animationId = requestAnimationFrame(updateGamepadStatus);
                return;
            }

            statusEl.className = 'status connected';
            statusEl.textContent = '‚úÖ –ì–µ–π–º–ø–∞–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω: ' + gamepad.id;
            infoEl.style.display = 'block';

            // Gamepad ID
            document.getElementById('gamepadId').innerHTML = 
                '<strong>ID:</strong> ' + gamepad.id + '<br>' +
                '<strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–µ–π:</strong> ' + gamepad.axes.length + '<br>' +
                '<strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫:</strong> ' + gamepad.buttons.length;

            // Axes
            let axesHtml = '';
            for (let i = 0; i < gamepad.axes.length; i++) {
                const value = gamepad.axes[i];
                const percent = ((value + 1) / 2) * 100;
                const isActive = Math.abs(value) > 0.1;
                const color = isActive ? '#4CAF50' : '#666';
                
                if (isActive) {
                    detectedAxes.add(i);
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Å–∏
                let axisName = 'Axis ' + i;
                if (i === 0) axisName = 'Axis 0 (–æ–±—ã—á–Ω–æ Roll/Aileron)';
                if (i === 1) axisName = 'Axis 1 (–æ–±—ã—á–Ω–æ Pitch/Elevator)';
                if (i === 2) axisName = 'Axis 2 (–æ–±—ã—á–Ω–æ Throttle)';
                if (i === 3) axisName = 'Axis 3 (–æ–±—ã—á–Ω–æ Yaw/Rudder)';
                
                axesHtml += '<div class="axis">';
                axesHtml += '<div class="axis-label">';
                axesHtml += '<span><span class="axis-number">' + axisName + '</span></span>';
                axesHtml += '<span class="axis-raw">' + value.toFixed(4) + '</span>';
                axesHtml += '</div>';
                axesHtml += '<div class="axis-bar">';
                axesHtml += '<div class="axis-center"></div>';
                axesHtml += '<div class="axis-value" style="width:' + percent + '%; background:' + color + '"></div>';
                axesHtml += '</div>';
                axesHtml += '</div>';

                lastValues[i] = value;
            }
            document.getElementById('axes').innerHTML = axesHtml;

            // Buttons
            let buttonsHtml = '';
            for (let i = 0; i < gamepad.buttons.length; i++) {
                const pressed = gamepad.buttons[i].pressed;
                const className = pressed ? 'button pressed' : 'button';
                buttonsHtml += '<div class="' + className + '">BTN ' + i + '</div>';
            }
            document.getElementById('buttons').innerHTML = buttonsHtml;

            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            if (detectedAxes.size >= 2) {
                const recommendEl = document.getElementById('recommendation');
                recommendEl.style.display = 'block';
                
                let configHtml = '<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Å–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>';
                configHtml += '<table>';
                configHtml += '<tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è Taranis</th></tr>';
                
                // Pitch (–≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥)
                const pitchAxis = detectedAxes.has(1) ? 1 : Array.from(detectedAxes)[0];
                configHtml += '<tr>';
                configHtml += '<td><code>PITCH_AXIS</code><br>(–≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥)</td>';
                configHtml += '<td class="highlight">Axis 1</td>';
                configHtml += '<td>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>Axis ' + pitchAxis + '</strong>';
                if (pitchAxis === 1) configHtml += ' ‚úÖ';
                configHtml += '</td>';
                configHtml += '</tr>';
                
                // Yaw (–ø–æ–≤–æ—Ä–æ—Ç)
                const yawAxis = detectedAxes.has(3) ? 3 : (detectedAxes.has(0) ? 0 : Array.from(detectedAxes)[1] || 3);
                configHtml += '<tr>';
                configHtml += '<td><code>YAW_AXIS</code><br>(–ø–æ–≤–æ—Ä–æ—Ç)</td>';
                configHtml += '<td class="highlight">Axis 3</td>';
                configHtml += '<td>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>Axis ' + yawAxis + '</strong>';
                if (yawAxis === 3) configHtml += ' ‚úÖ';
                configHtml += '</td>';
                configHtml += '</tr>';
                
                configHtml += '</table>';
                
                if (pitchAxis !== 1 || yawAxis !== 3) {
                    configHtml += '<div class="warning">‚ö†Ô∏è <strong>–¢–†–ï–ë–£–ï–¢–°–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò!</strong></div>';
                    configHtml += '<p>–û—Ç–∫—Ä–æ–π—Ç–µ <code>src/config/index.ts</code> –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:</p>';
                    configHtml += '<pre style="background:#1e1e1e; padding:15px; border-radius:5px; overflow-x:auto;"><code>';
                    configHtml += 'export const GAMEPAD_CONFIG = {\n';
                    configHtml += '  POLL_INTERVAL: 50,\n';
                    configHtml += '  DEADZONE: 0.1,\n';
                    configHtml += '  MAX_LINEAR_SPEED: 0.5,\n';
                    configHtml += '  MAX_ANGULAR_SPEED: 1.0,\n';
                    configHtml += '  <strong style="color:#f44336">PITCH_AXIS: ' + pitchAxis + ',  // ‚Üê –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–û</strong>\n';
                    configHtml += '  <strong style="color:#f44336">YAW_AXIS: ' + yawAxis + ',    // ‚Üê –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–û</strong>\n';
                    configHtml += '};</code></pre>';
                } else {
                    configHtml += '<div style="background:#4CAF50; color:white; padding:15px; border-radius:8px; margin-top:15px;">';
                    configHtml += '‚úÖ <strong>–û—Ç–ª–∏—á–Ω–æ!</strong> –í–∞—à Taranis X7 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Å–∏. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π!';
                    configHtml += '</div>';
                }
                
                document.getElementById('configText').innerHTML = configHtml;
            }

            animationId = requestAnimationFrame(updateGamepadStatus);
        }

        window.addEventListener('gamepadconnected', (e) => {
            console.log('‚úÖ Gamepad connected:', e.gamepad);
            console.log('ID:', e.gamepad.id);
            console.log('Axes:', e.gamepad.axes.length);
            console.log('Buttons:', e.gamepad.buttons.length);
        });

        window.addEventListener('gamepaddisconnected', (e) => {
            console.log('‚ùå Gamepad disconnected:', e.gamepad);
            detectedAxes.clear();
        });

        // Start polling
        console.log('üéÆ Gamepad Tester –∑–∞–ø—É—â–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Taranis X7...');
        updateGamepadStatus();
    </script>
</body>
</html>
